Polars user guide

[](https://github.com/pola-rs/polars)

pola-rs/polars

-   py-1.32.3
-   35k
-   2.4k

-    Polars
    Polars
    -        

        [ User guide ](https://docs.pola.rs/)

        User guide
        -   [ Getting started
            ](https://docs.pola.rs/user-guide/getting-started/)

        -   [ Installation
            ](https://docs.pola.rs/user-guide/installation/)

        -        

            [ Concepts ](https://docs.pola.rs/user-guide/concepts/)

            Concepts
            -   [ Data types and structures
                ](https://docs.pola.rs/user-guide/concepts/data-types-and-structures/)
            -   [ Expressions and contexts
                ](https://docs.pola.rs/user-guide/concepts/expressions-and-contexts/)
            -    Lazy API [ Lazy API
                ](https://docs.pola.rs/user-guide/concepts/lazy-api/)
                Table of contents
                -   [ When to use which
                    ](https://docs.pola.rs/user-guide/concepts/lazy-api/#when-to-use-which)
                -   [ Previewing the query plan
                    ](https://docs.pola.rs/user-guide/concepts/lazy-api/#previewing-the-query-plan)
            -   [ Streaming
                ](https://docs.pola.rs/user-guide/concepts/streaming/)

        -        

            [ Expressions
            ](https://docs.pola.rs/user-guide/expressions/)

            Expressions
            -   [ Basic operations
                ](https://docs.pola.rs/user-guide/expressions/basic-operations/)
            -   [ Expression expansion
                ](https://docs.pola.rs/user-guide/expressions/expression-expansion/)
            -   [ Casting
                ](https://docs.pola.rs/user-guide/expressions/casting/)
            -   [ Strings
                ](https://docs.pola.rs/user-guide/expressions/strings/)
            -   [ Lists and arrays
                ](https://docs.pola.rs/user-guide/expressions/lists-and-arrays/)
            -   [ Categorical data and enums
                ](https://docs.pola.rs/user-guide/expressions/categorical-data-and-enums/)
            -   [ Structs
                ](https://docs.pola.rs/user-guide/expressions/structs/)
            -   [ Missing data
                ](https://docs.pola.rs/user-guide/expressions/missing-data/)
            -   [ Aggregation
                ](https://docs.pola.rs/user-guide/expressions/aggregation/)
            -   [ Window functions
                ](https://docs.pola.rs/user-guide/expressions/window-functions/)
            -   [ Folds
                ](https://docs.pola.rs/user-guide/expressions/folds/)
            -   [ User-defined Python functions
                ](https://docs.pola.rs/user-guide/expressions/user-defined-python-functions/)
            -   [ Numpy functions
                ](https://docs.pola.rs/user-guide/expressions/numpy-functions/)

        -        

            [ Transformations
            ](https://docs.pola.rs/user-guide/transformations/)

            Transformations
            -   [ Joins
                ](https://docs.pola.rs/user-guide/transformations/joins/)
            -   [ Concatenation
                ](https://docs.pola.rs/user-guide/transformations/concatenation/)
            -   [ Pivots
                ](https://docs.pola.rs/user-guide/transformations/pivot/)
            -   [ Unpivots
                ](https://docs.pola.rs/user-guide/transformations/unpivot/)
            -    Time series
                Time series
                -   [ Parsing
                    ](https://docs.pola.rs/user-guide/transformations/time-series/parsing/)
                -   [ Filtering
                    ](https://docs.pola.rs/user-guide/transformations/time-series/filter/)
                -   [ Grouping
                    ](https://docs.pola.rs/user-guide/transformations/time-series/rolling/)
                -   [ Resampling
                    ](https://docs.pola.rs/user-guide/transformations/time-series/resampling/)
                -   [ Time zones
                    ](https://docs.pola.rs/user-guide/transformations/time-series/timezones/)

        -        

            [ Lazy API ](https://docs.pola.rs/user-guide/lazy/)

            Lazy API
            -   [ Usage ](https://docs.pola.rs/user-guide/lazy/using/)
            -   [ Optimizations
                ](https://docs.pola.rs/user-guide/lazy/optimizations/)
            -   [ Schema
                ](https://docs.pola.rs/user-guide/lazy/schemas/)
            -   [ DataType Expressions
                ](https://docs.pola.rs/user-guide/lazy/datatype_exprs/)
            -   [ Query plan
                ](https://docs.pola.rs/user-guide/lazy/query-plan/)
            -   [ Query execution
                ](https://docs.pola.rs/user-guide/lazy/execution/)
            -   [ Sources and sinks
                ](https://docs.pola.rs/user-guide/lazy/sources_sinks/)
            -   [ Multiplexing queries
                ](https://docs.pola.rs/user-guide/lazy/multiplexing/)
            -   [ GPU Support
                ](https://docs.pola.rs/user-guide/lazy/gpu/)

        -        

            [ IO ](https://docs.pola.rs/user-guide/io/)

            IO
            -   [ CSV ](https://docs.pola.rs/user-guide/io/csv/)
            -   [ Excel ](https://docs.pola.rs/user-guide/io/excel/)
            -   [ Parquet ](https://docs.pola.rs/user-guide/io/parquet/)
            -   [ JSON files ](https://docs.pola.rs/user-guide/io/json/)
            -   [ Multiple
                ](https://docs.pola.rs/user-guide/io/multiple/)
            -   [ Hive ](https://docs.pola.rs/user-guide/io/hive/)
            -   [ Databases
                ](https://docs.pola.rs/user-guide/io/database/)
            -   [ Cloud storage
                ](https://docs.pola.rs/user-guide/io/cloud-storage/)
            -   [ Google BigQuery
                ](https://docs.pola.rs/user-guide/io/bigquery/)
            -   [ Hugging Face
                ](https://docs.pola.rs/user-guide/io/hugging-face/)
            -   [ Google Sheets (via Colab)
                ](https://docs.pola.rs/user-guide/io/sheets_colab/)

        -        

            [ Plugins ](https://docs.pola.rs/user-guide/plugins/)

            Plugins
            -   [ Expression Plugins
                ](https://docs.pola.rs/user-guide/plugins/expr_plugins/)
            -   [ IO Plugins
                ](https://docs.pola.rs/user-guide/plugins/io_plugins/)

        -    SQL
            SQL
            -   [ Introduction
                ](https://docs.pola.rs/user-guide/sql/intro/)
            -   [ SHOW TABLES
                ](https://docs.pola.rs/user-guide/sql/show/)
            -   [ SELECT ](https://docs.pola.rs/user-guide/sql/select/)
            -   [ CREATE ](https://docs.pola.rs/user-guide/sql/create/)
            -   [ Common Table Expressions
                ](https://docs.pola.rs/user-guide/sql/cte/)

        -    Migrating
            Migrating
            -   [ Coming from Pandas
                ](https://docs.pola.rs/user-guide/migration/pandas/)
            -   [ Coming from Apache Spark
                ](https://docs.pola.rs/user-guide/migration/spark/)

        -   [ Ecosystem ](https://docs.pola.rs/user-guide/ecosystem/)

        -    Misc
            Misc
            -   [ Multiprocessing
                ](https://docs.pola.rs/user-guide/misc/multiprocessing/)
            -   [ Visualization
                ](https://docs.pola.rs/user-guide/misc/visualization/)
            -   [ Styling
                ](https://docs.pola.rs/user-guide/misc/styling/)
            -   [ Comparison with other tools
                ](https://docs.pola.rs/user-guide/misc/comparison/)
            -   [ Arrow producer/consumer
                ](https://docs.pola.rs/user-guide/misc/arrow/)
            -   [ Generating Polars code with LLMs
                ](https://docs.pola.rs/user-guide/misc/polars_llms/)

        -   [ GPU Support \[Open Beta\]
            ](https://docs.pola.rs/user-guide/gpu-support/)

    -    API
        API
        -   [ Reference guide ](https://docs.pola.rs/api/reference/)

    -    Development
        Development
        -        

            [ Contributing
            ](https://docs.pola.rs/development/contributing/)

            Contributing
            -   [ IDE configuration
                ](https://docs.pola.rs/development/contributing/ide/)
            -   [ Test suite
                ](https://docs.pola.rs/development/contributing/test/)
            -   [ Continuous integration
                ](https://docs.pola.rs/development/contributing/ci/)
            -   [ Code style
                ](https://docs.pola.rs/development/contributing/code-style/)

        -   [ Versioning ](https://docs.pola.rs/development/versioning/)

    -    Releases
        Releases
        -   [ Changelog ](https://docs.pola.rs/releases/changelog/)

        -        

            [ Upgrade guides ](https://docs.pola.rs/releases/upgrade/)

            Upgrade guides
            -   [ Version 1 ](https://docs.pola.rs/releases/upgrade/1/)
            -   [ Version 0.20
                ](https://docs.pola.rs/releases/upgrade/0.20/)
            -   [ Version 0.19
                ](https://docs.pola.rs/releases/upgrade/0.19/)

-        

    [ Polars Cloud ](https://docs.pola.rs/polars-cloud/)

    Polars Cloud
    -   [ Getting started
        ](https://docs.pola.rs/polars-cloud/quickstart/)
    -   [ Connect cloud environment
        ](https://docs.pola.rs/polars-cloud/connect-cloud/)
    -    Organizations
        Organizations
        -   [ Set up organization
            ](https://docs.pola.rs/polars-cloud/organization/organizations/)
        -   [ Payment and billing via AWS Marketplace
            ](https://docs.pola.rs/polars-cloud/organization/billing/)
    -    Workspaces
        Workspaces
        -   [ Configure settings
            ](https://docs.pola.rs/polars-cloud/workspace/settings/)
        -   [ Manage members
            ](https://docs.pola.rs/polars-cloud/workspace/team/)
    -    Workflows
        Workflows
        -   [ Define compute context
            ](https://docs.pola.rs/polars-cloud/run/compute-context/)
        -   [ Interactive or batch mode
            ](https://docs.pola.rs/polars-cloud/run/interactive-batch/)
        -   [ Execute distributed query
            ](https://docs.pola.rs/polars-cloud/run/distributed-engine/)
        -   [ Example workflow
            ](https://docs.pola.rs/polars-cloud/run/example-workflow/)
    -    Authentication
        Authentication
        -   [ Logging in
            ](https://docs.pola.rs/polars-cloud/explain/authentication/)
        -   [ Using service accounts
            ](https://docs.pola.rs/polars-cloud/explain/service-accounts/)
    -    Providers
        Providers
        -    AWS
            AWS
            -   [ Infrastructure
                ](https://docs.pola.rs/polars-cloud/providers/aws/infra/)
            -   [ Permissions
                ](https://docs.pola.rs/polars-cloud/providers/aws/permissions/)
    -    Misc
        Misc
        -   [ CLI ](https://docs.pola.rs/polars-cloud/cli/)
        -   [ FAQ ](https://docs.pola.rs/polars-cloud/faq/)
        -   [ API Reference ](https://docs.cloud.pola.rs)
        -   [ Release Notes
            ](https://docs.pola.rs/polars-cloud/release-notes/)

Table of contents

-   [ When to use which
    ](https://docs.pola.rs/user-guide/concepts/lazy-api/#when-to-use-which)
-   [ Previewing the query plan
    ](https://docs.pola.rs/user-guide/concepts/lazy-api/#previewing-the-query-plan)

# Lazy API

Polars supports two modes of operation: lazy and eager. The examples so
far have used the eager API, in which the query is executed immediately.
In the lazy API, the query is only evaluated once it is *collected*.
Deferring the execution to the last minute can have significant
performance advantages and is why the lazy API is preferred in most
cases. Let us demonstrate this with an example:

[ Python](#__tabbed_1_1)[ Rust](#__tabbed_1_2)

[
`read_csv`](https://docs.pola.rs/api/python/stable/reference/api/polars.read_csv.html)

    df = pl.read_csv("docs/assets/data/iris.csv")
    df_small = df.filter(pl.col("sepal_length") > 5)
    df_agg = df_small.group_by("species").agg(pl.col("sepal_width").mean())
    print(df_agg)

[
`CsvReader`](https://docs.pola.rs/api/rust/dev/polars/prelude/struct.CsvReader.html)
·[ Available on feature
csv](https://docs.pola.rs/user-guide/installation/#feature-flags)

    let df = CsvReadOptions::default()
        .try_into_reader_with_file_path(Some("docs/assets/data/iris.csv".into()))
        .unwrap()
        .finish()
        .unwrap();
    let mask = df.column("sepal_length")?.f64()?.gt(5.0);
    let df_small = df.filter(&mask)?;
    #[allow(deprecated)]
    let df_agg = df_small
        .group_by(["species"])?
        .select(["sepal_width"])
        .mean()?;
    println!("{df_agg}");

In this example we use the eager API to:

1.  Read the iris
    [dataset](https://archive.ics.uci.edu/dataset/53/iris).
2.  Filter the dataset based on sepal length.
3.  Calculate the mean of the sepal width per species.

Every step is executed immediately returning the intermediate results.
This can be very wasteful as we might do work or load extra data that is
not being used. If we instead used the lazy API and waited on execution
until all the steps are defined then the query planner could perform
various optimizations. In this case:

-   Predicate pushdown: Apply filters as early as possible while reading
    the dataset, thus only reading rows with sepal length greater than
    5.
-   Projection pushdown: Select only the columns that are needed while
    reading the dataset, thus removing the need to load additional
    columns (e.g., petal length and petal width).

[ Python](#__tabbed_2_1)[ Rust](#__tabbed_2_2)

[
`scan_csv`](https://docs.pola.rs/api/python/stable/reference/api/polars.scan_csv.html)

    q = (
        pl.scan_csv("docs/assets/data/iris.csv")
        .filter(pl.col("sepal_length") > 5)
        .group_by("species")
        .agg(pl.col("sepal_width").mean())
    )

    df = q.collect()

[
`LazyCsvReader`](https://docs.pola.rs/api/rust/dev/polars/prelude/struct.LazyCsvReader.html)
·[ Available on feature
csv](https://docs.pola.rs/user-guide/installation/#feature-flags)

    let q = LazyCsvReader::new(PlPath::new("docs/assets/data/iris.csv"))
        .with_has_header(true)
        .finish()?
        .filter(col("sepal_length").gt(lit(5)))
        .group_by(vec![col("species")])
        .agg([col("sepal_width").mean()]);
    let df = q.collect()?;
    println!("{df}");

These will significantly lower the load on memory & CPU thus allowing
you to fit bigger datasets in memory and process them faster. Once the
query is defined you call `collect` to inform Polars that you want to
execute it. You can [learn more about the lazy API in its dedicated
chapter](https://docs.pola.rs/user-guide/lazy/).

Eager API

In many cases the eager API is actually calling the lazy API under the
hood and immediately collecting the result. This has the benefit that
within the query itself optimization(s) made by the query planner can
still take place.

## When to use which

In general, the lazy API should be preferred unless you are either
interested in the intermediate results or are doing exploratory work and
don\'t know yet what your query is going to look like.

## Previewing the query plan

When using the lazy API you can use the function `explain` to ask Polars
to create a description of the query plan that will be executed once you
collect the results. This can be useful if you want to see what types of
optimizations Polars performs on your queries. We can ask Polars to
explain the query `q` we defined above:

[ Python](#__tabbed_3_1)[ Rust](#__tabbed_3_2)

[
`explain`](https://docs.pola.rs/api/python/stable/reference/lazyframe/api/polars.LazyFrame.explain.html)

    print(q.explain())

[
`explain`](https://docs.rs/polars/latest/polars/prelude/struct.LazyFrame.html#method.explain)

    let q = LazyCsvReader::new(PlPath::new("docs/assets/data/iris.csv"))
        .with_has_header(true)
        .finish()?
        .filter(col("sepal_length").gt(lit(5)))
        .group_by(vec![col("species")])
        .agg([col("sepal_width").mean()]);
    println!("{}", q.explain(true)?);

    AGGREGATE[maintain_order: false]
      [col("sepal_width").mean()] BY [col("species")]
      FROM
      Csv SCAN [docs/assets/data/iris.csv]
      PROJECT 3/5 COLUMNS
      SELECTION: [(col("sepal_length")) > (5.0)]

Immediately, we can see in the explanation that Polars did apply
predicate pushdown, as it is only reading rows where the sepal length is
greater than 5, and it did apply projection pushdown, as it is only
reading the columns that are needed by the query.

The function `explain` can also be used to see how expression expansion
will unfold in the context of a given schema. Consider the example
expression from the [section on expression
expansion](https://docs.pola.rs/user-guide/concepts/expressions-and-contexts/#expression-expansion):

    (pl.col(pl.Float64) * 1.1).name.suffix("*1.1")

We can use `explain` to see how this expression would evaluate against
an arbitrary schema:

[ Python](#__tabbed_4_1)

[
`explain`](https://docs.pola.rs/api/python/stable/reference/lazyframe/api/polars.LazyFrame.explain.html)

    schema = pl.Schema(
        {
            "int_1": pl.Int16,
            "int_2": pl.Int32,
            "float_1": pl.Float64,
            "float_2": pl.Float64,
            "float_3": pl.Float64,
        }
    )

    print(
        pl.LazyFrame(schema=schema)
        .select((pl.col(pl.Float64) * 1.1).name.suffix("*1.1"))
        .explain()
    )

    SELECT [[(col("float_1")) * (1.1)].alias("float_1*1.1"), [(col("float_2")) * (1.1)].alias("float_2*1.1"), [(col("float_3")) * (1.1)].alias("float_3*1.1")]
      DF ["int_1", "int_2", "float_1", "float_2", ...]; PROJECT["float_1", "float_2", "float_3"] 3/5 COLUMNS
